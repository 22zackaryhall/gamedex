// Equivalent to calling --continue from the command line.
// Will run all tests and produce a report of all failed tests at the end.
gradle.startParameter.continueOnFailure = true

buildscript {
    ext {
        appVersion = '0.1.0'
        javaMaxHeap = '3g'

        kotlin_version = '1.2.30'
        ktlin = [:].with {
            v = '1.2.30'
            majorV = '1.2'
            std = [group: 'org.jetbrains.kotlin', name: 'kotlin-stdlib-jdk8', version: v]
            reflect = [group: 'org.jetbrains.kotlin', name: 'kotlin-reflect', version: v]
            gradle = [group: 'org.jetbrains.kotlin', name: 'kotlin-gradle-plugin', version: v]
//            dokka = [group: 'org.jetbrains.dokka', name: 'dokka-gradle-plugin', version: '0.9.15']
            delegate
        }

        coroutines = [:].with {
            v = '0.22.3'
            core = [group: 'org.jetbrains.kotlinx', name: 'kotlinx-coroutines-core', version: v]
            rx2 = [group: 'org.jetbrains.kotlinx', name: 'kotlinx-coroutines-rx2', version: v]
            javaFx = [group: 'org.jetbrains.kotlinx', name: 'kotlinx-coroutines-javafx', version: v]
            delegate
        }

        guice = [group: 'com.google.inject', name: 'guice', version: '4.2.0']
        reflections = [group: 'org.reflections', name: 'reflections', version: '0.9.11']

        slf4j = [:].with {
            v = '1.7.25'
            api = [group: 'org.slf4j', name: 'slf4j-api', version: v]
            julBridge = [group: 'org.slf4j', name: 'jul-to-slf4j', version: v]
            delegate
        }
        logback = [group: 'ch.qos.logback', name: 'logback-classic', version: '1.2.3']

        typesafeConfig = [group: 'com.typesafe', name: 'config', version: '1.3.3']
        config4k = [group: 'io.github.config4k', name: 'config4k', version: '0.3.3']

        guava = [group: 'com.google.guava', name: 'guava', version: '24.0-jre']

        jodaTime = [group: 'joda-time', name: 'joda-time', version: '2.9.9']

        khttp = [group: 'com.github.jkcclemens', name: 'khttp', version: 'master-SNAPSHOT']

        jackson = [:].with {
            v = '2.9.1'
            core = [group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: v]
            kotlin = [group: 'com.fasterxml.jackson.module', name: 'jackson-module-kotlin', version: v]
            joda = [group: 'com.fasterxml.jackson.datatype', name: 'jackson-datatype-joda', version: v]
            delegate
        }

        h2 = [group: 'com.h2database', name: 'h2', version: '1.4.196']
        exposed = [group: 'org.jetbrains.exposed', name: 'exposed', version: '0.10.1']

        rx = [:].with {
            rxKotlin = [group: 'io.reactivex.rxjava2', name: 'rxkotlin', version: '2.2.0']
            rxKotlinFx = [group: 'com.github.thomasnield', name: 'rxkotlinfx', version: '2.2.2']
            delegate
        }

        controlsFx = [group: 'org.controlsfx', name: 'controlsfx', version: '8.40.14']
        jFoenix = [group: 'com.jfoenix', name: 'jfoenix', version: '8.0.2']
        tornadoFx = [:].with {
            core = [group: 'no.tornado', name: 'tornadofx', version: '1.7.15']
            controls = [group: 'no.tornado', name: 'tornadofx-controls', version: '1.0.6']
            delegate
        }
//        bootstrapFx = [group: 'org.kordamp.bootstrapfx', name: 'bootstrapfx-core', version: '0.2.2']

        diff = [group: 'com.googlecode.java-diff-utils', name: 'diffutils', version: '1.3.0']

        kotlinTest = [group: 'io.kotlintest', name: 'kotlintest', version: '2.0.7']
        junit = [group: 'junit', name: 'junit', version: '4.12']
        mockito = [:].with {
            core = [group: 'org.mockito', name: 'mockito-all', version: '1.10.19']
            kotlin = [group: 'com.nhaarman', name: 'mockito-kotlin', version: '1.5.0']
            delegate
        }

        ktor = [:].with {
            v = '0.9.1'
            core = [group: 'io.ktor', name: 'ktor-server-core', version: v]
            netty = [group: 'io.ktor', name: 'ktor-server-netty', version: v]
            delegate
        }
        wiremock = [group: 'com.github.tomakehurst', name: 'wiremock', version: '2.15.0']

        gradleJavaFx = [group: 'de.dynamicfiles.projects.gradle.plugins', name: 'javafx-gradle-plugin', version: '8.8.2']
        gradleVersions = [group: 'com.github.ben-manes', name: 'gradle-versions-plugin', version: '0.17.0']
        gradleLicense = [group: 'gradle.plugin.nl.javadude.gradle.plugins', name: 'license-gradle-plugin', version: '0.14.0']
    }

    repositories {
        mavenLocal()
        mavenCentral()
        jcenter()
        maven { url "https://plugins.gradle.org/m2/" }
    }

    dependencies {
        classpath ktlin.gradle
//        classpath ktlin.dokka
        classpath gradleJavaFx
        classpath gradleVersions
        classpath gradleLicense
    }
}

allprojects {
    apply plugin: 'java'
    apply plugin: 'maven-publish'
    apply plugin: 'com.github.ben-manes.versions'

    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    group 'com.gitlab.ykrasik'
    version appVersion

    repositories {
        mavenLocal()
        mavenCentral()
        jcenter()
        maven { url "https://jitpack.io" }
        maven { url "http://dl.bintray.com/kotlin/exposed" }
        maven { url "http://dl.bintray.com/kotlin/ktor" }
    }
}

subprojects {
    apply plugin: 'kotlin'
//    apply plugin: 'org.jetbrains.dokka'
    apply gradleFile('test.gradle')
    apply gradleFile('license.gradle')

    dependencies {
        compile ktlin.std
        compile ktlin.reflect
        compile coroutines.core

        compile slf4j.api

        compile guice

        testCompile junit
        testCompile kotlinTest
        testCompile mockito.core
        testCompile mockito.kotlin
    }

//    dokka {
//        outputFormat = 'javadoc'
//        outputDirectory = "$buildDir/javadoc"
//        processConfigurations = ['compile']
//    }

    compileKotlin {
        kotlinOptions.jvmTarget = '1.8'
        kotlinOptions.apiVersion = ktlin.majorV
        kotlinOptions.languageVersion = ktlin.majorV
    }
    compileTestKotlin {
        kotlinOptions.jvmTarget = '1.8'
        kotlinOptions.apiVersion = ktlin.majorV
        kotlinOptions.languageVersion = ktlin.majorV
    }
    kotlin {
        experimental {
            coroutines 'enable'
        }
    }
}

project("provider") {
    subprojects.each {
        it.fullDependency ":gamedex-api"
    }
}

def gradleFile(String fileName) { [from: file("gradle/$fileName")] }

// Easier to remember alias
task versions(dependsOn: dependencyUpdates)